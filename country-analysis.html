<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Country Analysis ‚Ä¢ Partner Report</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="data:,">
  <meta name="color-scheme" content="dark light">
  <meta name="description" content="Country analysis">
  <!-- Theme toggle (load first to prevent flash) -->
  <script src="theme-toggle.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <h1>Partner Report</h1>
      </div>
      <nav class="side-nav">
        <a href="index.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 10l9-7 9 7v10a2 2 0 0 1-2 2h-4v-6H9v6H5a2 2 0 0 1-2-2V10z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Home</span></a>
        <a href="clients.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Clients</span></a>
        <a href="commissions.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 19h16M4 15l4-4 3 3 6-6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Commissions</span></a>
        <a href="master-partner.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3l7 4v6c0 5-7 8-7 8s-7-3-7-8V7l7-4z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Master Partner</span></a>
        <a href="events.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="5" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/><path d="M16 3v4M8 3v4M3 11h18" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Events</span></a>
        <a href="tiers-badges.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3l3 6 6 1-4.5 4.4L17 21l-5-2.6L7 21l1.5-6.6L4 10l6-1 2-6z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Tiers &amp; Badges</span></a>
        <a href="client-funnel.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 5h18l-7 8v5l-4 2v-7L3 5z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Client Funnel</span></a>
        <a href="country-analysis.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Country Analysis</span></a>
        <a href="sitemap.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M10 3h4v4h-4V3zM4 17h4v4H4v-4zm12 0h4v4h-4v-4zM12 7v4m0 0H7v6m5-6h5v6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Sitemap</span></a>
        <a href="database.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><ellipse cx="12" cy="5" rx="8" ry="3" stroke="currentColor" stroke-width="2"/><path d="M4 5v6c0 1.7 3.6 3 8 3s8-1.3 8-3V5M4 11v6c0 1.7 3.6 3 8 3s8-1.3 8-3v-6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Database</span></a>
      </nav>
    </aside>
    <div class="content">
      <!-- Theme Toggle -->
      <div class="theme-toggle-container">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
          <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </div>

      <div class="container">
        <main class="panel">
      <h2 class="page-title">Country Analysis</h2>
      <p class="page-subtitle">Regional performance</p>

          <div class="card filter-bar" style="margin-bottom:16px; display: flex; justify-content: space-between; align-items: center;">
            <div>
              <select id="partnerSelect" style="width:100%; max-width:360px; padding:10px 12px; background:#0b1220; color:var(--text); border:1px solid rgba(148,163,184,0.3); border-radius:8px">
              <option value="">All partners</option>
            </select>
            </div>
            <div style="text-align: right;">
              <span id="partner-tier-display" class="tier-tag">‚Äî</span>
            </div>
          </div>

          <div class="card" style="margin-bottom:16px">
            <h3 style="margin-top:0">Filters</h3>
            <div class="filters-grid">
              <div class="filter-group">
                <label for="timePeriod">Time Period</label>
                <select id="timePeriod">
                  <option value="">All time</option>
                  <option value="2025-01">January 2025</option>
                  <option value="2025-02">February 2025</option>
                  <option value="2025-03">March 2025</option>
                  <option value="2025-04">April 2025</option>
                  <option value="2025-05">May 2025</option>
                  <option value="2025-06">June 2025</option>
                  <option value="2025-07">July 2025</option>
                  <option value="2025-08">August 2025</option>
                  <option value="2025-09">September 2025</option>
                  <option value="2025-10">October 2025</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="countryFilter">Country</label>
                <select id="countryFilter">
                  <option value="">All countries</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="platformFilter">Platform</label>
                <select id="platformFilter">
                  <option value="">All platforms</option>
                  <option value="WebTrader">WebTrader</option>
                  <option value="Mobile">Mobile</option>
                  <option value="MT5">MT5</option>
                  <option value="cTrader">cTrader</option>
                  <option value="DerivX">DerivX</option>
                  <option value="dTrader">dTrader</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="trackingFilter">Tracking Link</label>
                <select id="trackingFilter">
                  <option value="">All tracking links</option>
                </select>
              </div>
              <div class="filter-group">
                <label for="symbolFilter">Symbol</label>
                <select id="symbolFilter">
                  <option value="">All symbols</option>
                  <option value="EUR/USD">EUR/USD</option>
                  <option value="AAPL">AAPL</option>
                  <option value="BTC-USD">BTC-USD</option>
                  <option value="ETH-USD">ETH-USD</option>
                  <option value="XAUUSD">XAUUSD</option>
                  <option value="TSLA">TSLA</option>
                </select>
              </div>
            </div>
          </div>

          <div class="card" style="margin-bottom:16px">
            <h3 style="margin-top:0">üó∫Ô∏è World Map</h3>
            <p class="muted" style="margin-bottom: 12px;">Countries highlighted in blue have clients from the selected partner</p>
            <div id="world-map-container" style="width: 100%; height: 400px; display: flex; align-items: center; justify-content: center; background: rgba(148,163,184,0.05); border-radius: 8px;">
              <p class="muted">Loading map...</p>
            </div>
          </div>

          <div class="card" style="margin-bottom:16px">
            <h3 style="margin-top:0">Country Analysis Summary</h3>
            <div class="grid">
              <div class="card">
                <h4 style="margin:0 0 6px 0">Most Clients From</h4>
                <p class="muted" id="most-clients-country">‚Äî</p>
              </div>
              <div class="card">
                <h4 style="margin:0 0 6px 0">Most Commissions From</h4>
                <p class="muted" id="most-commissions-country">‚Äî</p>
              </div>
              <div class="card">
                <h4 style="margin:0 0 6px 0">Most Deposits From</h4>
                <p class="muted" id="most-deposits-country">‚Äî</p>
              </div>
              <div class="card">
                <h4 style="margin:0 0 6px 0">Most Volume From</h4>
                <p class="muted" id="most-volume-country">‚Äî</p>
              </div>
            </div>
          </div>

      <div class="card">
        <p class="muted">Country heatmap placeholder</p>
      </div>

          <div class="footer">v1.000 - partner report</div>
        </main>
      </div>
    </div>
  </div>

  <script>
    // Simple SVG world map renderer
    function renderWorldMap(partnerCountries) {
      var container = document.getElementById('world-map-container');
      if (!container) return;
      
      // Country list with approximate coordinates for simple visualization
      var countryCoords = {
        'Pakistan': {x: 650, y: 280},
        'India': {x: 700, y: 290},
        'Bangladesh': {x: 740, y: 300},
        'Nepal': {x: 720, y: 285},
        'United Arab Emirates': {x: 600, y: 295},
        'Saudi Arabia': {x: 580, y: 300},
        'Qatar': {x: 595, y: 295},
        'Oman': {x: 610, y: 310},
        'Kuwait': {x: 580, y: 285},
        'Bahrain': {x: 590, y: 295},
        'United Kingdom': {x: 420, y: 220},
        'United States': {x: 200, y: 260},
        'Canada': {x: 200, y: 220},
        'Australia': {x: 880, y: 460},
        'Singapore': {x: 770, y: 350},
        'Malaysia': {x: 770, y: 345},
        'Indonesia': {x: 800, y: 365},
        'Philippines': {x: 820, y: 320},
        'Thailand': {x: 760, y: 320},
        'Vietnam': {x: 775, y: 315},
        'China': {x: 780, y: 270},
        'Japan': {x: 850, y: 265},
        'South Korea': {x: 825, y: 265},
        'Germany': {x: 460, y: 220},
        'France': {x: 440, y: 235},
        'Italy': {x: 470, y: 250},
        'Spain': {x: 420, y: 255},
        'Netherlands': {x: 445, y: 215},
        'Turkey': {x: 550, y: 255},
        'Egypt': {x: 530, y: 285},
        'South Africa': {x: 530, y: 450},
        'Nigeria': {x: 460, y: 330},
        'Kenya': {x: 560, y: 350},
        'Brazil': {x: 320, y: 400},
        'Mexico': {x: 180, y: 305},
        'Argentina': {x: 310, y: 470}
      };
      
      var svg = '<svg width="100%" height="400" viewBox="0 0 1000 500" style="background: #0f172a;">';
      
      // Draw world outline (simplified continents)
      svg += '<rect x="0" y="0" width="1000" height="500" fill="#1e293b"/>';
      
      // Draw country markers
      Object.keys(countryCoords).forEach(function(country) {
        var coord = countryCoords[country];
        var isActive = partnerCountries.indexOf(country) !== -1;
        var color = isActive ? '#38bdf8' : '#475569';
        var radius = isActive ? 8 : 4;
        var opacity = isActive ? 1 : 0.3;
        
        svg += '<circle cx="' + coord.x + '" cy="' + coord.y + '" r="' + radius + '" ';
        svg += 'fill="' + color + '" opacity="' + opacity + '" stroke="#ffffff" stroke-width="1">';
        svg += '<title>' + country + (isActive ? ' ‚úì' : '') + '</title>';
        svg += '</circle>';
        
        // Add pulse animation for active countries
        if (isActive) {
          svg += '<circle cx="' + coord.x + '" cy="' + coord.y + '" r="' + radius + '" ';
          svg += 'fill="none" stroke="' + color + '" stroke-width="2" opacity="0.6">';
          svg += '<animate attributeName="r" from="' + radius + '" to="' + (radius + 10) + '" dur="2s" repeatCount="indefinite"/>';
          svg += '<animate attributeName="opacity" from="0.6" to="0" dur="2s" repeatCount="indefinite"/>';
          svg += '</circle>';
        }
      });
      
      svg += '</svg>';
      container.innerHTML = svg;
    }
    
    // Initialize map when data is loaded
    window.addEventListener('load', function() {
      // Get partner countries from cube or API
      var partnerSelect = document.getElementById('partnerSelect');
      if (partnerSelect) {
        function updateMap() {
          var partnerId = partnerSelect.value;
          if (!partnerId) {
            renderWorldMap([]);
            return;
          }
          
          // Fetch country data from cube
          fetch('api/index.php?endpoint=cubes&cube=countries&partner_id=' + partnerId)
            .then(function(r) { return r.json(); })
            .then(function(result) {
              if (result.success && result.data) {
                var countries = result.data.map(function(c) { return c.country; });
                renderWorldMap(countries);
              } else {
                renderWorldMap([]);
              }
            })
            .catch(function(e) {
              console.error('Error loading map data:', e);
              renderWorldMap([]);
            });
        }
        
        partnerSelect.addEventListener('change', updateMap);
        updateMap();
      }
    });
  </script>
</body>
</html>


