<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Client Lifecycle â€¢ Partner Report</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="data:,">
  <meta name="color-scheme" content="dark light">
  <meta name="description" content="Client lifecycle analytics and funnel analysis">
  
  <!-- API Manager and Advanced Charts -->
  <script src="api-manager.js"></script>
  <script src="advanced-charts.js"></script>
  <script src="forecasting.js"></script>
  <!-- Theme toggle (load first to prevent flash) -->
  <script src="theme-toggle.js"></script>
  <!-- Burger menu with all controls -->
  <script src="burger-menu.js"></script>
  <script defer src="script.js"></script>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <h1>Partner Report</h1>
      </div>
      <nav class="side-nav">
        <a href="index.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 10l9-7 9 7v10a2 2 0 0 1-2 2h-4v-6H9v6H5a2 2 0 0 1-2-2V10z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Home</span></a>
        <a href="clients.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Clients</span></a>
        <a href="commissions.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 19h16M4 15l4-4 3 3 6-6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Commissions</span></a>
        <a href="client-lifecycle.html" class="active"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 5h18l-7 8v5l-4 2v-7L3 5z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Client Lifecycle</span></a>
        <a href="master-partner.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3l7 4v6c0 5-7 8-7 8s-7-3-7-8V7l7-4z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Master Partner</span></a>
        <a href="events.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="5" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/><path d="M16 3v4M8 3v4M3 11h18" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Events</span></a>
        <a href="tiers-badges.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3l3 6 6 1-4.5 4.4L17 21l-5-2.6L7 21l1.5-6.6L4 10l6-1 2-6z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Tiers &amp; Badges</span></a>
        <a href="client-funnel.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 5h18l-7 8v5l-4 2v-7L3 5z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Client Funnel</span></a>
        <a href="country-analysis.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Country Analysis</span></a>
        <a href="sitemap.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M10 3h4v4h-4V3zM4 17h4v4H4v-4zm12 0h4v4h-4v-4zM12 7v4m0 0H7v6m5-6h5v6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Sitemap</span></a>
        <a href="database.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><ellipse cx="12" cy="5" rx="8" ry="3" stroke="currentColor" stroke-width="2"/><path d="M4 5v6c0 1.7 3.6 3 8 3s8-1.3 8-3V5M4 11v6c0 1.7 3.6 3 8 3s8-1.3 8-3v-6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Database</span></a>
      </nav>
    </aside>
    <div class="content">
      <!-- Theme Toggle -->
      <div class="theme-toggle-container">
        <button id="theme-toggle" class="theme-toggle" aria-label="Toggle theme">
          <svg class="sun-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          <svg class="moon-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </div>

      <!-- Top Filter Section -->
      <div class="top-filter-section" style="background: var(--panel); border-bottom: 1px solid rgba(148,163,184,0.1); padding: 16px 0;">
        <div class="container">
          <div style="display: flex; justify-content: space-between; align-items: center; gap: 16px;">
            <div style="flex: 1;">
              <label style="display: block; font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 8px;">Select Partner</label>
              <select id="partnerSelect" style="width:100%; max-width:400px; padding:10px 12px; background:var(--bg); color:var(--text); border:1px solid rgba(148,163,184,0.3); border-radius:8px; font-size: 14px;">
                <option value="">All partners</option>
              </select>
            </div>
            <div style="text-align: right;">
              <div style="font-size: 12px; color: var(--muted); margin-bottom: 4px;">Partner Tier</div>
              <span id="partner-tier-display" class="tier-tag">â€”</span>
            </div>
          </div>
        </div>
      </div>

      <div class="container">
        <main class="panel">
          <h2 class="page-title">Client Lifecycle Analytics</h2>
          <p class="page-subtitle">Comprehensive funnel analysis and client journey insights</p>

          <!-- Acquisition Funnel -->
          <div class="card" style="margin-bottom: 24px;">
            <h3 style="margin-top:0; text-align: center;">Acquisition Funnel</h3>
            <div id="acquisition-funnel" style="height: 400px;"></div>
            <div style="text-align: center; margin-top: 12px;">
              <button id="forecast-funnel" class="btn-secondary" style="padding: 8px 16px; font-size: 14px;">
                ðŸ“ˆ Enable Forecasting
              </button>
            </div>
          </div>

          <!-- Client Segmentation -->
          <div class="card" style="margin-bottom: 24px;">
            <h3 style="margin-top:0; text-align: center;">Client Segmentation</h3>
            <div id="client-segmentation" style="height: 300px;"></div>
          </div>

          <!-- Retention Analysis -->
          <div class="grid" style="grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px;">
            <div class="card">
              <h3 style="margin-top:0; text-align: center;">Retention Cohort</h3>
              <div id="retention-cohort" style="height: 300px; display: flex; align-items: center; justify-content: center;">
                <p class="muted">Loading retention analysis...</p>
              </div>
            </div>
            <div class="card">
              <h3 style="margin-top:0; text-align: center;">Churn Analysis</h3>
              <div id="churn-analysis" style="height: 300px; display: flex; align-items: center; justify-content: center;">
                <p class="muted">Loading churn analysis...</p>
              </div>
            </div>
          </div>

          <!-- Lifetime Value Analysis -->
          <div class="card" style="margin-bottom: 24px;">
            <h3 style="margin-top:0; text-align: center;">Client Lifetime Value Analysis</h3>
            <div id="lifetime-value" style="height: 300px;"></div>
          </div>

          <!-- Key Metrics Summary -->
          <div class="card">
            <h3 style="margin-top:0; text-align: center;">Key Lifecycle Metrics</h3>
            <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
              <div class="card" style="text-align: center;">
                <h4 style="margin:0 0 8px 0; color: #10b981;">Conversion Rate</h4>
                <p id="conversion-rate" class="muted" style="font-size: 24px; font-weight: 700;">â€”</p>
                <p style="font-size: 12px; color: var(--muted);">Signup to First Trade</p>
              </div>
              <div class="card" style="text-align: center;">
                <h4 style="margin:0 0 8px 0; color: #38bdf8;">Avg. Time to Deposit</h4>
                <p id="time-to-deposit" class="muted" style="font-size: 24px; font-weight: 700;">â€”</p>
                <p style="font-size: 12px; color: var(--muted);">Days from signup</p>
              </div>
              <div class="card" style="text-align: center;">
                <h4 style="margin:0 0 8px 0; color: #f59e0b;">Retention Rate</h4>
                <p id="retention-rate" class="muted" style="font-size: 24px; font-weight: 700;">â€”</p>
                <p style="font-size: 12px; color: var(--muted);">30-day retention</p>
              </div>
              <div class="card" style="text-align: center;">
                <h4 style="margin:0 0 8px 0; color: #8b5cf6;">Avg. CLV</h4>
                <p id="avg-clv" class="muted" style="font-size: 24px; font-weight: 700;">â€”</p>
                <p style="font-size: 12px; color: var(--muted);">Client Lifetime Value</p>
              </div>
            </div>
          </div>

          <div class="footer">v1.008 - partner report</div>
        </main>
      </div>
    </div>
  </div>

  <script>
    // Initialize Client Lifecycle Analytics
    function initClientLifecycle() {
      const partnerSelect = document.getElementById('partnerSelect');
      
      function updateLifecycleCharts() {
        const partnerId = partnerSelect ? partnerSelect.value : '';
        
        if (!partnerId) {
          // Clear all charts
          document.getElementById('acquisition-funnel').innerHTML = '<p class="muted" style="text-align: center; padding: 40px;">Select a partner to view lifecycle analytics</p>';
          document.getElementById('client-segmentation').innerHTML = '<p class="muted" style="text-align: center; padding: 40px;">Select a partner to view segmentation</p>';
          return;
        }
        
        // Initialize advanced charts
        if (window.AdvancedCharts) {
          // Acquisition Funnel
          window.AdvancedCharts.renderAcquisitionFunnel('acquisition-funnel', partnerId);
          
          // Client Segmentation (placeholder for now)
          document.getElementById('client-segmentation').innerHTML = '<p class="muted" style="text-align: center; padding: 40px;">Client segmentation analysis coming soon...</p>';
        }
        
        // Load lifecycle metrics
        loadLifecycleMetrics(partnerId);
      }
      
      function loadLifecycleMetrics(partnerId) {
        // Placeholder for lifecycle metrics
        document.getElementById('conversion-rate').textContent = '85.2%';
        document.getElementById('time-to-deposit').textContent = '3.2';
        document.getElementById('retention-rate').textContent = '72.1%';
        document.getElementById('avg-clv').textContent = '$1,247';
      }
      
      if (partnerSelect) {
        partnerSelect.addEventListener('change', updateLifecycleCharts);
        // Initial load
        setTimeout(updateLifecycleCharts, 100);
      }
    }
    
    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initClientLifecycle);
    } else {
      initClientLifecycle();
    }
  </script>
</body>
</html>
