<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Database • Partner Report</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="data:,">
  <meta name="color-scheme" content="dark light">
  <meta name="description" content="JSON database viewer">
  <script defer src="script.js"></script>
  <style>
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px 12px; border-bottom: 1px solid rgba(148,163,184,0.2); text-align: left; }
    th { color: var(--muted); font-weight: 600; }
    .table-wrap { overflow-x: auto; max-height: 400px; overflow-y: auto; }
    .section { margin-bottom: 28px; }
    
    .tabs { display: flex; border-bottom: 1px solid rgba(148,163,184,0.2); margin-bottom: 16px; }
    .tab { padding: 12px 16px; cursor: pointer; border-bottom: 2px solid transparent; color: var(--muted); transition: all 0.15s ease; }
    .tab:hover { color: var(--text); }
    .tab.active { color: var(--accent); border-bottom-color: var(--accent); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
  </style>
</head>
<body>
  <div class="layout">
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <h1>Partner Report</h1>
      </div>
      <nav class="side-nav">
        <a href="index.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 10l9-7 9 7v10a2 2 0 0 1-2 2h-4v-6H9v6H5a2 2 0 0 1-2-2V10z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Home</span></a>
        <a href="clients.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M16 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" stroke="currentColor" stroke-width="2"/><circle cx="9" cy="7" r="4" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Clients</span></a>
        <a href="commissions.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M4 19h16M4 15l4-4 3 3 6-6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Commissions</span></a>
        <a href="master-partner.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3l7 4v6c0 5-7 8-7 8s-7-3-7-8V7l7-4z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Master Partner</span></a>
        <a href="events.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><rect x="3" y="5" width="18" height="16" rx="2" stroke="currentColor" stroke-width="2"/><path d="M16 3v4M8 3v4M3 11h18" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Events</span></a>
        <a href="tiers-badges.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M12 3l3 6 6 1-4.5 4.4L17 21l-5-2.6L7 21l1.5-6.6L4 10l6-1 2-6z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Tiers &amp; Badges</span></a>
        <a href="client-funnel.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M3 5h18l-7 8v5l-4 2v-7L3 5z" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Client Funnel</span></a>
        <a href="country-analysis.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/><path d="M3 12h18M12 3a15 15 0 0 1 0 18M12 3a15 15 0 0 0 0 18" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Country Analysis</span></a>
        <a href="sitemap.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M10 3h4v4h-4V3zM4 17h4v4H4v-4zm12 0h4v4h-4v-4zM12 7v4m0 0H7v6m5-6h5v6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Sitemap</span></a>
        <a href="database.html"><span class="icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none"><ellipse cx="12" cy="5" rx="8" ry="3" stroke="currentColor" stroke-width="2"/><path d="M4 5v6c0 1.7 3.6 3 8 3s8-1.3 8-3V5M4 11v6c0 1.7 3.6 3 8 3s8-1.3 8-3v-6" stroke="currentColor" stroke-width="2"/></svg></span><span class="label">Database</span></a>
      </nav>
    </aside>
    <div class="content">
      <div class="container">
        <main class="panel">
          <h2 class="page-title">Database</h2>
          <p class="page-subtitle">JSON-backed tables: clients, trades, countries, partners</p>

          <div class="card filter-bar" style="margin-bottom:16px">
            <label for="partnerSelect" class="muted" style="display:block; margin-bottom:8px">Select partner</label>
            <select id="partnerSelect" style="width:100%; max-width:360px; padding:10px 12px; background:#0b1220; color:var(--text); border:1px solid rgba(148,163,184,0.3); border-radius:8px">
              <option value="">All partners</option>
            </select>
          </div>

          <div id="content"></div>

          <div class="footer">v1.0 • Static template</div>
        </main>
      </div>
    </div>
  </div>

  <script>
    function createTableFromArray(arr) {
      if (!Array.isArray(arr) || arr.length === 0) {
        var empty = document.createElement('div');
        empty.className = 'card';
        empty.textContent = 'No rows';
        return empty;
      }
      var columns = Array.from(new Set(arr.flatMap(function (row) { return Object.keys(row); })));
      var wrap = document.createElement('div');
      wrap.className = 'card table-wrap';
      var table = document.createElement('table');
      var thead = document.createElement('thead');
      var trHead = document.createElement('tr');
      columns.forEach(function (col) {
        var th = document.createElement('th'); th.textContent = col; trHead.appendChild(th);
      });
      thead.appendChild(trHead);
      var tbody = document.createElement('tbody');
      arr.forEach(function (row) {
        var tr = document.createElement('tr');
        columns.forEach(function (col) {
          var td = document.createElement('td');
          var v = row[col];
          td.textContent = (v == null) ? '' : (typeof v === 'object' ? JSON.stringify(v) : v);
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(thead);
      table.appendChild(tbody);
      wrap.appendChild(table);
      return wrap;
    }

    // If opened directly from the filesystem, fetch() may be blocked by the browser.
    if (location.protocol === 'file:') {
      var contentNotice = document.getElementById('content');
      var note = document.createElement('div');
      note.className = 'card';
      note.innerHTML = '<strong>Heads up</strong>: This page is opened using the <code>file://</code> protocol. Most browsers block fetches of local files for security reasons.\n\
      <div style="margin-top:8px">Run a local server in this folder, then open <code>http://localhost:8000/database.html</code>:</div>\n\
      <pre style="margin-top:8px; white-space:pre-wrap">python3 -m http.server 8000</pre>';
      contentNotice.appendChild(note);
    }

    fetch('database.json')
      .then(function (r) { return r.json(); })
      .then(function (db) {
        var content = document.getElementById('content');
        var sections = [
          { key: 'clients', title: 'Clients' },
          { key: 'trades', title: 'Trades' },
          { key: 'deposits', title: 'Deposits' },
          { key: 'countries', title: 'Countries' },
          { key: 'partners', title: 'Partners' },
          { key: 'platformContractTypes', title: 'Platform Contract Types' },
          { key: 'partnerTiers', title: 'Partner Tiers' },
          { key: 'symbols', title: 'Symbols' },
          { key: 'trackingLinks', title: 'Tracking Links' }
        ];
        
        // Create tabs
        var tabsContainer = document.createElement('div');
        tabsContainer.className = 'tabs';
        sections.forEach(function(section, index) {
          var tab = document.createElement('div');
          tab.className = 'tab' + (index === 0 ? ' active' : '');
          tab.textContent = section.title;
          tab.addEventListener('click', function() {
            // Remove active from all tabs and contents
            document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
            document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
            // Add active to clicked tab and corresponding content
            tab.classList.add('active');
            document.getElementById('tab-' + section.key).classList.add('active');
          });
          tabsContainer.appendChild(tab);
        });
        content.appendChild(tabsContainer);
        
        // Create tab contents
        sections.forEach(function(section, index) {
          var tabContent = document.createElement('div');
          tabContent.id = 'tab-' + section.key;
          tabContent.className = 'tab-content' + (index === 0 ? ' active' : '');
          var s = document.createElement('section');
          s.className = 'section';
          var h3 = document.createElement('h3'); h3.textContent = section.title; s.appendChild(h3);
          s.appendChild(createTableFromArray(db[section.key] || []));
          tabContent.appendChild(s);
          content.appendChild(tabContent);
        });
      })
      .catch(function (e) {
        var content = document.getElementById('content');
        var err = document.createElement('div'); err.className = 'card';
        err.innerHTML = 'Failed to load <code>database.json</code>: ' + String(e) +
          (location.protocol === 'file:' ? '\n\
          <div style="margin-top:8px">Tip: Start a local server with <code>python3 -m http.server 8000</code> and reload this page at <code>http://localhost:8000/database.html</code>.</div>' : '');
        content.appendChild(err);
      });
  </script>
</body>
</html>


